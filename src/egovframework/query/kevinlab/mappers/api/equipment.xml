<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="equipmentMapper">
			
	<!-- 8LINE : EQUIPMENTDATA DATA, 183LINE : EQUIPMENTGRAPH DATA -->
						
	<!-- EQUIPMENTDATA DATA -->
	<select id="equipmentData" parameterType="HashMap" resultType="HashMap">
	/*에너지현황 시간별 현황 equipmentMapper.equipmentData*/
	SELECT
		A.VAL_DATE AS VAL_DATE,
		ROUND(SUM(A.ELEHOTWATERVAL) / 1000) AS ELEHOTWATERVAL,
		ROUND(A.FEEDVAL / 1000) AS FEEDVAL,
		ROUND(A.SUMPVAL / 1000) AS SUMPVAL,
		ROUND(A.CIRCULATINGVAL / 1000) AS CIRCULATINGVAL,
		A.ELEHOTWATER_USE,
		A.FEED_USE,
		A.SUMP_USE,
		A.CIRCULATING_USE
	FROM
	(
		SELECT
			IFNULL(SUBSTR(C.VAL_DATE, 1, 8), "00000000") AS VAL_DATE,
			IFNULL(MAX(C.TOTAL_WH) - MIN(C.TOTAL_WH), 0) AS ELEHOTWATERVAL,
			IFNULL(D.VAL, 0) AS FEEDVAL,
			IFNULL(E.VAL, 0) AS SUMPVAL,
			IFNULL(F.VAL, 0) AS CIRCULATINGVAL,
			IFNULL(B.FG_USE, "n") AS ELEHOTWATER_USE,
			IFNULL(D.FG_USE, "n") AS FEED_USE,
			IFNULL(E.FG_USE, "n") AS SUMP_USE,
			IFNULL(F.FG_USE, "n") AS CIRCULATING_USE	
		FROM
			${dbname}.bems_home AS A
		LEFT JOIN
			${dbname}.bems_sensor_electric_hotwater AS B
		ON
			A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
		AND
			A.HOME_DONG_PK = B.HOME_DONG_PK
		AND
			A.HOME_HO_PK = B.HOME_HO_PK
		LEFT JOIN
			${dbname}.bems_meter_electric_hotwater AS C
		ON
			B.SENSOR_SN = C.SENSOR_SN
		LEFT JOIN
		(
			SELECT
				IFNULL(A.VAL_DATE, "00000000") AS VAL_DATE,
				IFNULL(SUM(A.VAL), 0) AS VAL,
				IFNULL(A.FG_USE, "Y") AS FG_USE
			FROM
			(
				SELECT
					C.SENSOR_SN,
					B.FG_USE,
					SUBSTR(C.VAL_DATE, 1, 8) AS VAL_DATE,
					MAX(C.TOTAL_WH) - MIN(C.TOTAL_WH) AS VAL
				FROM
					${dbname}.bems_home AS A
				LEFT JOIN
					${dbname}.bems_sensor_electric_water AS B
				ON
					A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
				AND
					A.HOME_DONG_PK = B.HOME_DONG_PK
				AND
					A.HOME_HO_PK = B.HOME_HO_PK
				LEFT JOIN
					${dbname}.bems_meter_electric_water AS C
				ON
					B.SENSOR_SN = C.SENSOR_SN
				WHERE
					C.VAL_DATE <![CDATA[>=]]> #{fromdate}
				AND
					C.VAL_DATE <![CDATA[<=]]> #{todate}
				AND
					A.COMPLEX_CODE_PK = #{complexcode}
				AND
					C.SENSOR_SN = "2002_2_2"
				GROUP BY C.SENSOR_SN, SUBSTR(C.VAL_DATE, 1, 8)
			)A
			GROUP BY A.VAL_DATE
		)D
		ON
			SUBSTR(C.VAL_DATE, 1, 8) = D.VAL_DATE
		LEFT JOIN
		(
			SELECT
				IFNULL(A.VAL_DATE, "00000000") AS VAL_DATE,
				IFNULL(SUM(A.VAL), 0) AS VAL,
				IFNULL(A.FG_USE, "Y") AS FG_USE
			FROM
			(
				SELECT
					C.SENSOR_SN,
					B.FG_USE,
					SUBSTR(C.VAL_DATE, 1, 8) AS VAL_DATE,
					MAX(C.TOTAL_WH) - MIN(C.TOTAL_WH) AS VAL
				FROM
					${dbname}.bems_home AS A
				LEFT JOIN
					${dbname}.bems_sensor_electric_water AS B
				ON
					A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
				AND
					A.HOME_DONG_PK = B.HOME_DONG_PK
				AND
					A.HOME_HO_PK = B.HOME_HO_PK
				LEFT JOIN
					${dbname}.bems_meter_electric_water AS C
				ON
					B.SENSOR_SN = C.SENSOR_SN
				WHERE
					C.VAL_DATE <![CDATA[>=]]> #{fromdate}
				AND
					C.VAL_DATE <![CDATA[<=]]> #{todate}
				AND
					A.COMPLEX_CODE_PK = #{complexcode}
				AND
					C.SENSOR_SN = "2002_2_5"
				GROUP BY C.SENSOR_SN, SUBSTR(C.VAL_DATE, 1, 8)
			)A
			GROUP BY A.VAL_DATE
		)E
		ON
			SUBSTR(C.VAL_DATE, 1, 8) = E.VAL_DATE
		LEFT JOIN
		(
			SELECT
				IFNULL(A.VAL_DATE, "00000000") AS VAL_DATE,
				IFNULL(SUM(A.VAL), 0) AS VAL,
				IFNULL(A.FG_USE, "Y") AS FG_USE
			FROM
			(
				SELECT
					C.SENSOR_SN,
					B.FG_USE,
					SUBSTR(C.VAL_DATE, 1, 8) AS VAL_DATE,
					MAX(C.TOTAL_WH) - MIN(C.TOTAL_WH) AS VAL
				FROM
					${dbname}.bems_home AS A
				LEFT JOIN
					${dbname}.bems_sensor_electric_hotwater AS B
				ON
					A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
				AND
					A.HOME_DONG_PK = B.HOME_DONG_PK
				AND
					A.HOME_HO_PK = B.HOME_HO_PK
				LEFT JOIN
					${dbname}.bems_meter_electric_hotwater AS C
				ON
					B.SENSOR_SN = C.SENSOR_SN
				WHERE
					C.VAL_DATE <![CDATA[>=]]> #{fromdate}
				AND
					C.VAL_DATE <![CDATA[<=]]> #{todate}
				AND
					A.COMPLEX_CODE_PK = #{complexcode}
				AND
					C.SENSOR_SN IN ("2002_2_3", "2002_2_4")
				GROUP BY C.SENSOR_SN, SUBSTR(C.VAL_DATE, 1, 8)
			)A
			GROUP BY A.VAL_DATE
		)F
		ON
			SUBSTR(C.VAL_DATE, 1, 8) = F.VAL_DATE
		WHERE
			C.VAL_DATE <![CDATA[>=]]> #{fromdate}
		AND
			C.VAL_DATE <![CDATA[<=]]> #{todate}
		AND
			C.SENSOR_SN IN ("2002_2_6", "2002_3_2", "2002_4_2", "2002_7_3", "2002_8_2")
		AND
			A.COMPLEX_CODE_PK = #{complexcode}
		GROUP BY C.SENSOR_SN, SUBSTR(C.VAL_DATE, 1, 8)
	)A
	GROUP BY A.VAL_DATE
	</select>
	
	<!-- EQUIPMENTGRAPH DATA -->
	<select id="equipmentGraph"  parameterType="HashMap" resultType="HashMap">
	/*에너지현황 5분별 현황 equipmentMapper.equipmentGraph*/
	SELECT
		'전기온수기' AS TITLE,
		IFNULL(C.VAL_DATE, '00000000') AS VAL_DATE,
		ROUND(IFNULL(SUM(C.VAL), 0) / 1000, 2) AS VAL,
		ROUND(IFNULL(SUM(C.VAL_0), 0) / 1000, 2) AS VAL_0,
		ROUND(IFNULL(SUM(C.VAL_1), 0) / 1000, 2) AS VAL_1,
		ROUND(IFNULL(SUM(C.VAL_2), 0) / 1000, 2) AS VAL_2,
		ROUND(IFNULL(SUM(C.VAL_3), 0) / 1000, 2) AS VAL_3,
		ROUND(IFNULL(SUM(C.VAL_4), 0) / 1000, 2) AS VAL_4,
		ROUND(IFNULL(SUM(C.VAL_5), 0) / 1000, 2) AS VAL_5,
		ROUND(IFNULL(SUM(C.VAL_6), 0) / 1000, 2) AS VAL_6,
		ROUND(IFNULL(SUM(C.VAL_7), 0) / 1000, 2) AS VAL_7,
		ROUND(IFNULL(SUM(C.VAL_8), 0) / 1000, 2) AS VAL_8,
		ROUND(IFNULL(SUM(C.VAL_9), 0) / 1000, 2) AS VAL_9,
		ROUND(IFNULL(SUM(C.VAL_10), 0) / 1000, 2) AS VAL_10,
		ROUND(IFNULL(SUM(C.VAL_11), 0) / 1000, 2) AS VAL_11,
		ROUND(IFNULL(SUM(C.VAL_12), 0) / 1000, 2) AS VAL_12,
		ROUND(IFNULL(SUM(C.VAL_13), 0) / 1000, 2) AS VAL_13,
		ROUND(IFNULL(SUM(C.VAL_14), 0) / 1000, 2) AS VAL_14,
		ROUND(IFNULL(SUM(C.VAL_15), 0) / 1000, 2) AS VAL_15,
		ROUND(IFNULL(SUM(C.VAL_16), 0) / 1000, 2) AS VAL_16,
		ROUND(IFNULL(SUM(C.VAL_17), 0) / 1000, 2) AS VAL_17,
		ROUND(IFNULL(SUM(C.VAL_18), 0) / 1000, 2) AS VAL_18,
		ROUND(IFNULL(SUM(C.VAL_19), 0) / 1000, 2) AS VAL_19,
		ROUND(IFNULL(SUM(C.VAL_20), 0) / 1000, 2) AS VAL_20,
		ROUND(IFNULL(SUM(C.VAL_21), 0) / 1000, 2) AS VAL_21,
		ROUND(IFNULL(SUM(C.VAL_22), 0) / 1000, 2) AS VAL_22,
		ROUND(IFNULL(SUM(C.VAL_23), 0) / 1000, 2) AS VAL_23
	FROM
		${dbname}.bems_home AS A
	LEFT JOIN
		${dbname}.bems_sensor_electric_hotwater AS B
	ON
		A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
	AND
		A.HOME_DONG_PK = B.HOME_DONG_PK
	AND
		A.HOME_HO_PK = B.HOME_HO_PK
	LEFT JOIN
		${dbname}.bems_stat_daily_electric_hotwater AS C 
	ON
		B.SENSOR_SN = C.SENSOR_SN
	WHERE
		B.FG_USE = "Y"
	AND
		C.VAL_DATE LIKE #{fromdate}
	AND
		A.COMPLEX_CODE_PK = #{complexcode}
	AND
		C.SENSOR_SN IN ("2002_2_6", "2002_3_2", "2002_4_2", "2002_7_3", "2002_8_2")
	UNION ALL
	SELECT
		'급수펌프' AS TITLE,
		IFNULL(C.VAL_DATE, '00000000') AS VAL_DATE,
		ROUND(IFNULL(SUM(C.VAL), 0) / 1000, 2) AS VAL,
		ROUND(IFNULL(SUM(C.VAL_0), 0) / 1000, 2) AS VAL_0,
		ROUND(IFNULL(SUM(C.VAL_1), 0) / 1000, 2) AS VAL_1,
		ROUND(IFNULL(SUM(C.VAL_2), 0) / 1000, 2) AS VAL_2,
		ROUND(IFNULL(SUM(C.VAL_3), 0) / 1000, 2) AS VAL_3,
		ROUND(IFNULL(SUM(C.VAL_4), 0) / 1000, 2) AS VAL_4,
		ROUND(IFNULL(SUM(C.VAL_5), 0) / 1000, 2) AS VAL_5,
		ROUND(IFNULL(SUM(C.VAL_6), 0) / 1000, 2) AS VAL_6,
		ROUND(IFNULL(SUM(C.VAL_7), 0) / 1000, 2) AS VAL_7,
		ROUND(IFNULL(SUM(C.VAL_8), 0) / 1000, 2) AS VAL_8,
		ROUND(IFNULL(SUM(C.VAL_9), 0) / 1000, 2) AS VAL_9,
		ROUND(IFNULL(SUM(C.VAL_10), 0) / 1000, 2) AS VAL_10,
		ROUND(IFNULL(SUM(C.VAL_11), 0) / 1000, 2) AS VAL_11,
		ROUND(IFNULL(SUM(C.VAL_12), 0) / 1000, 2) AS VAL_12,
		ROUND(IFNULL(SUM(C.VAL_13), 0) / 1000, 2) AS VAL_13,
		ROUND(IFNULL(SUM(C.VAL_14), 0) / 1000, 2) AS VAL_14,
		ROUND(IFNULL(SUM(C.VAL_15), 0) / 1000, 2) AS VAL_15,
		ROUND(IFNULL(SUM(C.VAL_16), 0) / 1000, 2) AS VAL_16,
		ROUND(IFNULL(SUM(C.VAL_17), 0) / 1000, 2) AS VAL_17,
		ROUND(IFNULL(SUM(C.VAL_18), 0) / 1000, 2) AS VAL_18,
		ROUND(IFNULL(SUM(C.VAL_19), 0) / 1000, 2) AS VAL_19,
		ROUND(IFNULL(SUM(C.VAL_20), 0) / 1000, 2) AS VAL_20,
		ROUND(IFNULL(SUM(C.VAL_21), 0) / 1000, 2) AS VAL_21,
		ROUND(IFNULL(SUM(C.VAL_22), 0) / 1000, 2) AS VAL_22,
		ROUND(IFNULL(SUM(C.VAL_23), 0) / 1000, 2) AS VAL_23
	FROM
		${dbname}.bems_home AS A
	LEFT JOIN
		${dbname}.bems_sensor_electric_water AS B
	ON
		A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
	AND
		A.HOME_DONG_PK = B.HOME_DONG_PK
	AND
		A.HOME_HO_PK = B.HOME_HO_PK
	LEFT JOIN
		${dbname}.bems_stat_daily_electric_water AS C 
	ON
		B.SENSOR_SN = C.SENSOR_SN
	WHERE
		B.FG_USE = "Y"
	AND
		C.VAL_DATE LIKE #{fromdate}
	AND
		A.COMPLEX_CODE_PK = #{complexcode}
	AND
		C.SENSOR_SN = "2002_2_2"
	UNION ALL
	SELECT
		'배수펌프' AS TITLE,
		IFNULL(C.VAL_DATE, '00000000') AS VAL_DATE,
		ROUND(IFNULL(SUM(C.VAL), 0) / 1000, 2) AS VAL,
		ROUND(IFNULL(SUM(C.VAL_0), 0) / 1000, 2) AS VAL_0,
		ROUND(IFNULL(SUM(C.VAL_1), 0) / 1000, 2) AS VAL_1,
		ROUND(IFNULL(SUM(C.VAL_2), 0) / 1000, 2) AS VAL_2,
		ROUND(IFNULL(SUM(C.VAL_3), 0) / 1000, 2) AS VAL_3,
		ROUND(IFNULL(SUM(C.VAL_4), 0) / 1000, 2) AS VAL_4,
		ROUND(IFNULL(SUM(C.VAL_5), 0) / 1000, 2) AS VAL_5,
		ROUND(IFNULL(SUM(C.VAL_6), 0) / 1000, 2) AS VAL_6,
		ROUND(IFNULL(SUM(C.VAL_7), 0) / 1000, 2) AS VAL_7,
		ROUND(IFNULL(SUM(C.VAL_8), 0) / 1000, 2) AS VAL_8,
		ROUND(IFNULL(SUM(C.VAL_9), 0) / 1000, 2) AS VAL_9,
		ROUND(IFNULL(SUM(C.VAL_10), 0) / 1000, 2) AS VAL_10,
		ROUND(IFNULL(SUM(C.VAL_11), 0) / 1000, 2) AS VAL_11,
		ROUND(IFNULL(SUM(C.VAL_12), 0) / 1000, 2) AS VAL_12,
		ROUND(IFNULL(SUM(C.VAL_13), 0) / 1000, 2) AS VAL_13,
		ROUND(IFNULL(SUM(C.VAL_14), 0) / 1000, 2) AS VAL_14,
		ROUND(IFNULL(SUM(C.VAL_15), 0) / 1000, 2) AS VAL_15,
		ROUND(IFNULL(SUM(C.VAL_16), 0) / 1000, 2) AS VAL_16,
		ROUND(IFNULL(SUM(C.VAL_17), 0) / 1000, 2) AS VAL_17,
		ROUND(IFNULL(SUM(C.VAL_18), 0) / 1000, 2) AS VAL_18,
		ROUND(IFNULL(SUM(C.VAL_19), 0) / 1000, 2) AS VAL_19,
		ROUND(IFNULL(SUM(C.VAL_20), 0) / 1000, 2) AS VAL_20,
		ROUND(IFNULL(SUM(C.VAL_21), 0) / 1000, 2) AS VAL_21,
		ROUND(IFNULL(SUM(C.VAL_22), 0) / 1000, 2) AS VAL_22,
		ROUND(IFNULL(SUM(C.VAL_23), 0) / 1000, 2) AS VAL_23
	FROM
		${dbname}.bems_home AS A
	LEFT JOIN
		${dbname}.bems_sensor_electric_water AS B
	ON
		A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
	AND
		A.HOME_DONG_PK = B.HOME_DONG_PK
	AND
		A.HOME_HO_PK = B.HOME_HO_PK
	LEFT JOIN
		${dbname}.bems_stat_daily_electric_water AS C 
	ON
		B.SENSOR_SN = C.SENSOR_SN
	WHERE
		B.FG_USE = "Y"
	AND
		C.VAL_DATE LIKE #{fromdate}
	AND
		A.COMPLEX_CODE_PK = #{complexcode}
	AND
		C.SENSOR_SN = "2002_2_5"
	UNION ALL
	SELECT
		'순환펌프' AS TITLE,
		IFNULL(C.VAL_DATE, '00000000') AS VAL_DATE,
		ROUND(IFNULL(SUM(C.VAL), 0) / 1000, 2) AS VAL,
		ROUND(IFNULL(SUM(C.VAL_0), 0) / 1000, 2) AS VAL_0,
		ROUND(IFNULL(SUM(C.VAL_1), 0) / 1000, 2) AS VAL_1,
		ROUND(IFNULL(SUM(C.VAL_2), 0) / 1000, 2) AS VAL_2,
		ROUND(IFNULL(SUM(C.VAL_3), 0) / 1000, 2) AS VAL_3,
		ROUND(IFNULL(SUM(C.VAL_4), 0) / 1000, 2) AS VAL_4,
		ROUND(IFNULL(SUM(C.VAL_5), 0) / 1000, 2) AS VAL_5,
		ROUND(IFNULL(SUM(C.VAL_6), 0) / 1000, 2) AS VAL_6,
		ROUND(IFNULL(SUM(C.VAL_7), 0) / 1000, 2) AS VAL_7,
		ROUND(IFNULL(SUM(C.VAL_8), 0) / 1000, 2) AS VAL_8,
		ROUND(IFNULL(SUM(C.VAL_9), 0) / 1000, 2) AS VAL_9,
		ROUND(IFNULL(SUM(C.VAL_10), 0) / 1000, 2) AS VAL_10,
		ROUND(IFNULL(SUM(C.VAL_11), 0) / 1000, 2) AS VAL_11,
		ROUND(IFNULL(SUM(C.VAL_12), 0) / 1000, 2) AS VAL_12,
		ROUND(IFNULL(SUM(C.VAL_13), 0) / 1000, 2) AS VAL_13,
		ROUND(IFNULL(SUM(C.VAL_14), 0) / 1000, 2) AS VAL_14,
		ROUND(IFNULL(SUM(C.VAL_15), 0) / 1000, 2) AS VAL_15,
		ROUND(IFNULL(SUM(C.VAL_16), 0) / 1000, 2) AS VAL_16,
		ROUND(IFNULL(SUM(C.VAL_17), 0) / 1000, 2) AS VAL_17,
		ROUND(IFNULL(SUM(C.VAL_18), 0) / 1000, 2) AS VAL_18,
		ROUND(IFNULL(SUM(C.VAL_19), 0) / 1000, 2) AS VAL_19,
		ROUND(IFNULL(SUM(C.VAL_20), 0) / 1000, 2) AS VAL_20,
		ROUND(IFNULL(SUM(C.VAL_21), 0) / 1000, 2) AS VAL_21,
		ROUND(IFNULL(SUM(C.VAL_22), 0) / 1000, 2) AS VAL_22,
		ROUND(IFNULL(SUM(C.VAL_23), 0) / 1000, 2) AS VAL_23
	FROM
		${dbname}.bems_home AS A
	LEFT JOIN
		${dbname}.bems_sensor_electric_hotwater AS B
	ON
		A.COMPLEX_CODE_PK = B.COMPLEX_CODE_PK
	AND
		A.HOME_DONG_PK = B.HOME_DONG_PK
	AND
		A.HOME_HO_PK = B.HOME_HO_PK
	LEFT JOIN
		${dbname}.bems_stat_daily_electric_hotwater AS C 
	ON
		B.SENSOR_SN = C.SENSOR_SN
	WHERE
		B.FG_USE = "Y"
	AND
		C.VAL_DATE LIKE #{fromdate}
	AND
		A.COMPLEX_CODE_PK = #{complexcode}
	AND
		C.SENSOR_SN IN ("2002_2_3", "2002_2_4")
	ORDER BY VAL_DATE DESC
	</select>
	<!-- 8LINE : SENSOR DATA, 32LINE : EQUIPMENTDATA DATA, 201LINE : EQUIPMENTGRAPH DATA -->
</mapper>